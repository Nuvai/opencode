#!/usr/bin/env bash
#
# OpenCode Reinstall Script
#
# Usage:
#   curl -fsSL https://raw.githubusercontent.com/Nuvai/opencode/main/reinstall | bash
#   ./reinstall [--version <version>]
#
# This script removes the existing installation and installs fresh.
#

set -euo pipefail

RED='\033[0;31m'
GREEN='\033[0;32m'
MUTED='\033[0;2m'
NC='\033[0m'

INSTALL_DIR="$HOME/.opencode/bin"
VERSION_ARG=""

# Parse arguments
while [[ $# -gt 0 ]]; do
    case "$1" in
        -v|--version)
            VERSION_ARG="$2"
            shift 2
            ;;
        -h|--help)
            echo "Usage: reinstall [--version <version>]"
            echo ""
            echo "Options:"
            echo "  -v, --version    Install specific version (e.g., 1.1.51)"
            exit 0
            ;;
        *)
            shift
            ;;
    esac
done

echo -e "${MUTED}Reinstalling OpenCode...${NC}"
echo ""

# Remove existing binary
if [[ -f "$INSTALL_DIR/opencode" ]]; then
    rm -f "$INSTALL_DIR/opencode"
    echo -e "${GREEN}âœ“${NC} Removed existing installation"
fi

# Download and run install script
echo -e "${MUTED}Downloading fresh installation...${NC}"
echo ""

if [[ -n "$VERSION_ARG" ]]; then
    curl -fsSL https://raw.githubusercontent.com/Nuvai/opencode/main/install | bash -s -- --version "$VERSION_ARG"
else
    curl -fsSL https://raw.githubusercontent.com/Nuvai/opencode/main/install | bash
fi
